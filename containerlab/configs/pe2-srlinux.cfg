# PE2 SR Linux Configuration
# Initial configuration for AURORA-IBN testing

set / system information location "AURORA-IBN East PE"
set / system information contact "Aurora IBN Controller"

# Management interface
set / interface mgmt0 admin-state enable
set / interface mgmt0 subinterface 0 admin-state enable
set / interface mgmt0 subinterface 0 ipv4 dhcp-client

# Loopback for BGP/MPLS
set / interface lo0 admin-state enable
set / interface lo0 subinterface 0 admin-state enable
set / interface lo0 subinterface 0 ipv4 address 10.0.0.2/32

# Core-facing interface
set / interface ethernet-1/1 admin-state enable
set / interface ethernet-1/1 subinterface 0 admin-state enable
set / interface ethernet-1/1 subinterface 0 ipv4 address 10.1.1.5/30
set / interface ethernet-1/1 subinterface 0 description "to-P1-core"

# BGP RR connection
set / interface ethernet-1/2 admin-state enable
set / interface ethernet-1/2 subinterface 0 admin-state enable
set / interface ethernet-1/2 subinterface 0 ipv4 address 10.1.2.5/30
set / interface ethernet-1/2 subinterface 0 description "to-RR1"

# Customer interface (CE2)
set / interface ethernet-1/3 admin-state enable
set / interface ethernet-1/3 subinterface 0 admin-state enable
set / interface ethernet-1/3 subinterface 0 description "to-CE2-ACME"

# ISIS for underlay
set / network-instance default protocols isis instance isis-main admin-state enable
set / network-instance default protocols isis instance isis-main level-capability L2
set / network-instance default protocols isis instance isis-main net [ 49.0001.0100.0000.0002.00 ]
set / network-instance default protocols isis instance isis-main interface ethernet-1/1.0 passive false
set / network-instance default protocols isis instance isis-main interface ethernet-1/2.0 passive false
set / network-instance default protocols isis instance isis-main interface lo0.0 passive true

# BGP configuration
set / network-instance default protocols bgp admin-state enable
set / network-instance default protocols bgp autonomous-system 65000
set / network-instance default protocols bgp router-id 10.0.0.2

# IBGP to Route Reflector
set / network-instance default protocols bgp neighbor 10.0.0.21 admin-state enable
set / network-instance default protocols bgp neighbor 10.0.0.21 peer-as 65000
set / network-instance default protocols bgp neighbor 10.0.0.21 peer-group ibgp
set / network-instance default protocols bgp neighbor 10.0.0.21 transport local-address 10.0.0.2

set / network-instance default protocols bgp group ibgp admin-state enable
set / network-instance default protocols bgp group ibgp next-hop-self true
set / network-instance default protocols bgp group ibgp afi-safi ipv4-unicast admin-state enable
set / network-instance default protocols bgp group ibgp afi-safi vpnv4 admin-state enable

# MPLS configuration
set / network-instance default protocols mpls admin-state enable
set / network-instance default protocols mpls interface ethernet-1/1.0
set / network-instance default protocols mpls interface ethernet-1/2.0

# LDP
set / network-instance default protocols ldp admin-state enable
set / network-instance default protocols ldp router-id 10.0.0.2
set / network-instance default protocols ldp interface ethernet-1/1.0
set / network-instance default protocols ldp interface ethernet-1/2.0

# Enable NETCONF/gNMI/gNOI
set / system management netconf-server admin-state enable
set / system management netconf-server network-instance mgmt
set / system management netconf-server source-address ::

set / system grpc-server admin-state enable
set / system grpc-server network-instance mgmt
set / system grpc-server source-address ::
set / system grpc-server unix-socket admin-state enable

# JSON-RPC for API access
set / system json-rpc-server admin-state enable
set / system json-rpc-server network-instance mgmt

commit save